<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1111px" preserveAspectRatio="none" style="width:702px;height:1111px;" version="1.1" viewBox="0 0 702 1111" width="702px" zoomAndPan="magnify"><defs><filter height="300%" id="f1kdb5ytlr3u73" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="244" y="23.5352">readPresensePulse sequence</text><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="975.7637" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="212" y="105.7988"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="217" y="788.6992"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="217" y="935.6309"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="217" y="1009.9414"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="423" y="178.4199"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="34.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="423" y="221.7305"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="423" y="491.2148"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="290.3516"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="401.2832"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="34.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="579.1465"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="34.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="703.3887"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="469.3477" style="stroke: #000000; stroke-width: 2.0;" width="667" x="13" y="362.6621"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="17.3105" style="stroke: #000000; stroke-width: 2.0;" width="241" x="154.5" y="445.5938"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="85.9316" style="stroke: #000000; stroke-width: 2.0;" width="631" x="29" y="535.5254"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="117.2422" style="stroke: #000000; stroke-width: 2.0;" width="647" x="23" y="635.457"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="85.9316" style="stroke: #000000; stroke-width: 2.0;" width="627" x="33" y="659.7676"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="163.9316" style="stroke: #000000; stroke-width: 2.0;" width="381" x="134.5" y="889.3203"/><rect fill="#FFFFFF" height="74.3105" style="stroke: none; stroke-width: 1.0;" width="381" x="134.5" y="978.9414"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="216.5" x2="216.5" y1="74.4883" y2="1099.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="428" x2="428" y1="74.4883" y2="1099.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="580" x2="580" y1="74.4883" y2="1099.5625"/><a target="_top" xlink:actuate="onRequest" xlink:href="../Class/OneWireDriver.svg" xlink:show="new" xlink:title="../Class/OneWireDriver.svg" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1kdb5ytlr3u73)" height="36" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="144.5" y="33.4883"/><ellipse cx="162.5" cy="51.4883" fill="#008000" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M158.2139,45.0952 L161.1357,45.0952 L162.6133,50.5322 L164.0825,45.0952 L167.021,45.0952 L167.021,57.4883 L164.9126,57.4883 L164.9126,47.5605 L163.6011,52.981 L161.6504,52.981 L160.3223,47.5605 L160.3223,57.4883 L158.2139,57.4883 Z "/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="179.5" y="54.4883">OneWireDriver</text></a><a target="_top" xlink:actuate="onRequest" xlink:href="../Class/OneWireDriver.svg" xlink:show="new" xlink:title="../Class/OneWireDriver.svg" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1kdb5ytlr3u73)" height="36" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="356" y="33.4883"/><ellipse cx="374" cy="51.4883" fill="#008000" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M369.7139,45.0952 L372.6357,45.0952 L374.1133,50.5322 L375.5825,45.0952 L378.521,45.0952 L378.521,57.4883 L376.4126,57.4883 L376.4126,47.5605 L375.1011,52.981 L373.1504,52.981 L371.8223,47.5605 L371.8223,57.4883 L369.7139,57.4883 Z "/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="391" y="54.4883">GPIO_Wrapper</text></a><a target="_top" xlink:actuate="onRequest" xlink:href="../Class/OneWireDriver.svg" xlink:show="new" xlink:title="../Class/OneWireDriver.svg" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1kdb5ytlr3u73)" height="36" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="510" y="33.4883"/><ellipse cx="528" cy="51.4883" fill="#008000" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M523.7139,45.0952 L526.6357,45.0952 L528.1133,50.5322 L529.5825,45.0952 L532.521,45.0952 L532.521,57.4883 L530.4126,57.4883 L530.4126,47.5605 L529.1011,52.981 L527.1504,52.981 L525.8223,47.5605 L525.8223,57.4883 L523.7139,57.4883 Z "/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="545" y="54.4883">Wait_Wrapper</text></a><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="975.7637" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="212" y="105.7988"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="217" y="788.6992"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="217" y="935.6309"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="217" y="1009.9414"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="423" y="178.4199"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="34.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="423" y="221.7305"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="423" y="491.2148"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="290.3516"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="401.2832"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="34.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="579.1465"/><rect fill="#FFFFFF" filter="url(#f1kdb5ytlr3u73)" height="34.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="703.3887"/><polygon fill="#A80036" points="200,101.7988,210,105.7988,200,109.7988,204,105.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="206" y1="105.7988" y2="105.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="10" y="101.0566">readPresensePulse()</text><rect fill="#EEEEEE" filter="url(#f1kdb5ytlr3u73)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="687" x="3" y="134.4541"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="690" y1="134.4541" y2="134.4541"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="690" y1="137.4541" y2="137.4541"/><rect fill="#EEEEEE" filter="url(#f1kdb5ytlr3u73)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="190" x="251.5" y="123.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176" x="257.5" y="140.3672">Initialize and 1st measure</text><polygon fill="#A80036" points="411,174.4199,421,178.4199,411,182.4199,415,178.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="222" x2="417" y1="178.4199" y2="178.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="229" y="173.6777">SetPin2RxMode()</text><polygon fill="#A80036" points="233,188.4199,223,192.4199,233,196.4199,229,192.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="427" y1="192.4199" y2="192.4199"/><polygon fill="#A80036" points="411,217.7305,421,221.7305,411,225.7305,415,221.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="222" x2="417" y1="221.7305" y2="221.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="229" y="216.9883">GetPinState()</text><polygon fill="#A80036" points="233,252.041,223,256.041,233,260.041,229,256.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="427" y1="256.041" y2="256.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="239" y="251.2988">previous state = Pin status</text><path d="M79,234.7305 L79,259.7305 L203,259.7305 L203,244.7305 L193,234.7305 L79,234.7305 " fill="#FBFB77" filter="url(#f1kdb5ytlr3u73)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M193,234.7305 L193,244.7305 L203,244.7305 L193,234.7305 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="85" y="252.2988">Initial pin status</text><polygon fill="#A80036" points="563,286.3516,573,290.3516,563,294.3516,567,290.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="222" x2="569" y1="290.3516" y2="290.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="229" y="285.6094">ClearTimerCount()</text><polygon fill="#A80036" points="233,300.3516,223,304.3516,233,308.3516,229,304.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="579" y1="304.3516" y2="304.3516"/><rect fill="#EEEEEE" filter="url(#f1kdb5ytlr3u73)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="687" x="3" y="333.0068"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="690" y1="333.0068" y2="333.0068"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="690" y1="336.0068" y2="336.0068"/><rect fill="#EEEEEE" filter="url(#f1kdb5ytlr3u73)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="98" x="297.5" y="322.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="303.5" y="338.9199">Detect pulse</text><path d="M13,362.6621 L87,362.6621 L87,369.6621 L77,379.6621 L13,379.6621 L13,362.6621 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="469.3477" style="stroke: #000000; stroke-width: 2.0;" width="667" x="13" y="362.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="28" y="376.2305">loop</text><polygon fill="#A80036" points="563,397.2832,573,401.2832,563,405.2832,567,401.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="222" x2="569" y1="401.2832" y2="401.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="229" y="396.541">GetTimerCount()</text><polygon fill="#A80036" points="233,426.5938,223,430.5938,233,434.5938,229,430.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="579" y1="430.5938" y2="430.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="239" y="425.8516">TimerCount</text><path d="M154.5,445.5938 L238.5,445.5938 L238.5,452.5938 L228.5,462.5938 L154.5,462.5938 L154.5,445.5938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="17.3105" style="stroke: #000000; stroke-width: 2.0;" width="241" x="154.5" y="445.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="169.5" y="459.1621">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="253.5" y="458.2285">[TimerCount &gt; T_RSTH]</text><polygon fill="#A80036" points="411,487.2148,421,491.2148,411,495.2148,415,491.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="222" x2="417" y1="491.2148" y2="491.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="229" y="486.4727">GetPinState()</text><polygon fill="#A80036" points="233,516.5254,223,520.5254,233,524.5254,229,520.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="427" y1="520.5254" y2="520.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="239" y="515.7832">current state = Pin status</text><path d="M29,535.5254 L96,535.5254 L96,542.5254 L86,552.5254 L29,552.5254 L29,535.5254 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.9316" style="stroke: #000000; stroke-width: 2.0;" width="631" x="29" y="535.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="44" y="549.0938">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="407" x="111" y="548.1602">[previous pin status[GPIO_NEGATED] &amp; new pin staus[GPIO_ASSERTED]]</text><polygon fill="#A80036" points="563,575.1465,573,579.1465,563,583.1465,567,579.1465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="222" x2="569" y1="579.1465" y2="579.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="229" y="574.4043">GetTimerCount()</text><path d="M39,557.8359 L39,582.8359 L203,582.8359 L203,567.8359 L193,557.8359 L39,557.8359 " fill="#FBFB77" filter="url(#f1kdb5ytlr3u73)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M193,557.8359 L193,567.8359 L203,567.8359 L193,557.8359 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="45" y="575.4043">Detect pin falling edge</text><polygon fill="#A80036" points="233,609.457,223,613.457,233,617.457,229,613.457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="579" y1="613.457" y2="613.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="239" y="608.7148">startCnt = Timer count</text><path d="M23,635.457 L90,635.457 L90,642.457 L80,652.457 L23,652.457 L23,635.457 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="117.2422" style="stroke: #000000; stroke-width: 2.0;" width="647" x="23" y="635.457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="38" y="649.0254">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="105" y="648.0918">[startCnt[already get]]</text><path d="M33,659.7676 L100,659.7676 L100,666.7676 L90,676.7676 L33,676.7676 L33,659.7676 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.9316" style="stroke: #000000; stroke-width: 2.0;" width="627" x="33" y="659.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="673.3359">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="429" x="115" y="672.4023">[previous pin status[GPIO_ASSERTED] &amp; current pin status[GPIO_NEGATED]]</text><polygon fill="#A80036" points="563,699.3887,573,703.3887,563,707.3887,567,703.3887" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="222" x2="569" y1="703.3887" y2="703.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="229" y="698.6465">GetTimerCount()</text><path d="M43,682.0781 L43,707.0781 L203,707.0781 L203,692.0781 L193,682.0781 L43,682.0781 " fill="#FBFB77" filter="url(#f1kdb5ytlr3u73)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M193,682.0781 L193,692.0781 L203,692.0781 L193,682.0781 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="49" y="699.6465">Detect pin rising edge</text><polygon fill="#A80036" points="233,733.6992,223,737.6992,233,741.6992,229,737.6992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="579" y1="737.6992" y2="737.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="239" y="732.957">endCnt = Timer count</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="227" x2="269" y1="781.0098" y2="781.0098"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="269" y1="781.0098" y2="794.0098"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="228" x2="269" y1="794.0098" y2="794.0098"/><polygon fill="#A80036" points="238,790.0098,228,794.0098,238,798.0098,234,794.0098" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="234" y="776.2676">previous state = current state</text><rect fill="#EEEEEE" filter="url(#f1kdb5ytlr3u73)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="687" x="3" y="859.665"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="690" y1="859.665" y2="859.665"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="690" y1="862.665" y2="862.665"/><rect fill="#EEEEEE" filter="url(#f1kdb5ytlr3u73)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="155" x="269" y="849.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="275" y="865.5781">Evaluate pulse width</text><path d="M134.5,889.3203 L201.5,889.3203 L201.5,896.3203 L191.5,906.3203 L134.5,906.3203 L134.5,889.3203 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.9316" style="stroke: #000000; stroke-width: 2.0;" width="381" x="134.5" y="889.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="149.5" y="902.8887">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="294" x="216.5" y="901.9551">[(endCnt - startCnt)[T_PDLOW_MIN,T_PDLOW_MAX]]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="227" x2="269" y1="927.9414" y2="927.9414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="269" y1="927.9414" y2="940.9414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="228" x2="269" y1="940.9414" y2="940.9414"/><polygon fill="#A80036" points="238,936.9414,228,940.9414,238,944.9414,234,940.9414" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="234" y="923.1992">result = ONE_WIRE_SUCCESS</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="134.5" x2="515.5" y1="979.9414" y2="979.9414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="227" x2="269" y1="1002.252" y2="1002.252"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="269" y1="1002.252" y2="1015.252"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="228" x2="269" y1="1015.252" y2="1015.252"/><polygon fill="#A80036" points="238,1011.252,228,1015.252,238,1019.252,234,1015.252" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="234" y="997.5098">result = ONE_WIRE_FAIL</text><polygon fill="#A80036" points="14,1077.5625,4,1081.5625,14,1085.5625,10,1081.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="8" x2="216" y1="1081.5625" y2="1081.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="20" y="1076.8203">result</text><!--
@startuml

hide footbox

title readPresensePulse sequence

participant "OneWireDriver" as ModuleOneWireDriver<<M,Green>>[[../Class/OneWireDriver.svg]]
participant "GPIO_Wrapper" as ModuleGPIO_Wrapper<<M,Green>>[[../Class/OneWireDriver.svg]]
participant "Wait_Wrapper" as ModuleWait_Wrapper<<M,Green>>[[../Class/OneWireDriver.svg]]


-> ModuleOneWireDriver : readPresensePulse()
  activate ModuleOneWireDriver

==Initialize and 1st measure==
ModuleOneWireDriver -> ModuleGPIO_Wrapper : SetPin2RxMode()
  activate ModuleGPIO_Wrapper
ModuleOneWireDriver <- - ModuleGPIO_Wrapper
  deactivate ModuleGPIO_Wrapper

ModuleOneWireDriver -> ModuleGPIO_Wrapper : GetPinState()
  activate ModuleGPIO_Wrapper
ModuleOneWireDriver <- - ModuleGPIO_Wrapper : previous state = Pin status
note left
  Initial pin status
end note
  deactivate ModuleGPIO_Wrapper

ModuleOneWireDriver -> ModuleWait_Wrapper : ClearTimerCount()
  activate ModuleWait_Wrapper
ModuleOneWireDriver <- - ModuleWait_Wrapper
  deactivate ModuleWait_Wrapper

==Detect pulse==
loop
  ModuleOneWireDriver -> ModuleWait_Wrapper : GetTimerCount()
    activate ModuleWait_Wrapper
  ModuleOneWireDriver <- - ModuleWait_Wrapper : TimerCount
    deactivate ModuleWait_Wrapper

  break TimerCount > T_RSTH
  end

  ModuleOneWireDriver -> ModuleGPIO_Wrapper : GetPinState()
    activate ModuleGPIO_Wrapper
  ModuleOneWireDriver <- - ModuleGPIO_Wrapper : current state = Pin status
    deactivate ModuleGPIO_Wrapper

  opt previous pin status[GPIO_NEGATED] & new pin staus[GPIO_ASSERTED]
    ModuleOneWireDriver -> ModuleWait_Wrapper : GetTimerCount()
    note left
      Detect pin falling edge
    end note
      activate ModuleWait_Wrapper
    ModuleOneWireDriver <- - ModuleWait_Wrapper : startCnt = Timer count
      deactivate ModuleWait_Wrapper
  end

  opt startCnt[already get]
    opt previous pin status[GPIO_ASSERTED] & current pin status[GPIO_NEGATED]
      ModuleOneWireDriver -> ModuleWait_Wrapper : GetTimerCount()
      note left
        Detect pin rising edge
      end note
        activate ModuleWait_Wrapper
      ModuleOneWireDriver <- - ModuleWait_Wrapper : endCnt = Timer count
        deactivate ModuleWait_Wrapper
    end
  end

  ModuleOneWireDriver -> ModuleOneWireDriver : previous state = current state
    activate ModuleOneWireDriver
    deactivate ModuleOneWireDriver
end

==Evaluate pulse width==
opt (endCnt - startCnt)[T_PDLOW_MIN,T_PDLOW_MAX]
  ModuleOneWireDriver -> ModuleOneWireDriver : result = ONE_WIRE_SUCCESS
    activate ModuleOneWireDriver
    deactivate ModuleOneWireDriver
else
  ModuleOneWireDriver -> ModuleOneWireDriver : result = ONE_WIRE_FAIL
    activate ModuleOneWireDriver
    deactivate ModuleOneWireDriver
end

<- - ModuleOneWireDriver : result
  deactivate ModuleOneWireDriver

@enduml

PlantUML version 1.2018.09(Sat Jul 28 01:58:18 JST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 9.0.1+11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>